---
import '../../styles/global.css'
import '../../styles/work.css'
import BaseLayout from '../../layouts/BaseLayout.astro'
import Gallery from '../../components/Gallery.astro'
import { getAllSeries, getSeriesBySlug } from '../../lib/queries'
import { getCloudinaryImages } from '../../lib/cloudinary'

export async function getStaticPaths() {
  const series = await getAllSeries()
  return series.map((s) => ({
    params: { slug: s.slug },
  }))
}

const { slug } = Astro.params
const series = await getSeriesBySlug(slug!)
const images = await getCloudinaryImages(slug!)

if (!series) {
  throw new Error(`Series not found for slug: ${slug}`)
}

// Build-time diagnostics: log image count so deploy logs show it
console.log(`BUILD: series slug=${slug} -> images.length=${images.length}`)
---

<BaseLayout title={`${series.title} Â· Mathis Heck`} description={series.description || `Photo series ${series.title} by Mathis Heck`}>

  <main>
    <div class="header">
      <h1 class="detail-title">{series.title}</h1>
      {series.year && <div class="meta"><span>{series.year}</span></div>}
      {series.description && <p class="description">{series.description}</p>}
    </div>

    {`<!-- image-count: ${images.length} -->`}
    <Gallery images={images} slug={series.slug} />
  </main>
</BaseLayout>
